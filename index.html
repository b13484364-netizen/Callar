<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أداة البحث عن المعلومات العامة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        secondary: '#818cf8'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        
        .search-card {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .search-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(93, 92, 222, 0.15);
            border-color: #5D5CDE;
        }
        
        .result-item {
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
            transform: translateY(20px);
        }
        
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .pulse-ring {
            animation: pulse-ring 1.25s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }
        
        @keyframes pulse-ring {
            0% {
                transform: scale(.33);
            }
            80%, 100% {
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 transition-colors duration-300">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-gradient-to-r from-primary to-secondary text-white py-6 shadow-lg">
            <div class="container mx-auto px-4 text-center">
                <h1 class="text-3xl font-bold mb-2">
                    <i class="fas fa-search mr-3"></i>
                    أداة البحث عن المعلومات العامة
                </h1>
                <p class="text-blue-100">البحث في المعلومات المتاحة علناً فقط</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto px-4 py-8">
            <!-- Privacy Notice -->
            <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-700 rounded-lg p-4 mb-8">
                <div class="flex items-start">
                    <i class="fas fa-shield-alt text-yellow-600 dark:text-yellow-400 text-xl mr-3 mt-1"></i>
                    <div>
                        <h3 class="font-bold text-yellow-800 dark:text-yellow-200 mb-2">تنبيه مهم حول الخصوصية</h3>
                        <p class="text-yellow-700 dark:text-yellow-300 text-sm">
                            هذه الأداة تساعد في البحث عن المعلومات العامة المتاحة فقط. 
                            يُرجى استخدامها بمسؤولية واحترام خصوصية الآخرين.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Search Form -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 mb-8">
                <div class="max-w-md mx-auto">
                    <label for="phoneNumber" class="block text-gray-700 dark:text-gray-300 font-bold mb-4 text-lg">
                        <i class="fas fa-phone mr-2"></i>
                        رقم الهاتف المحمول
                    </label>
                    <div class="relative">
                        <input 
                            type="tel" 
                            id="phoneNumber" 
                            placeholder="مثال: +966501234567"
                            class="w-full px-4 py-3 text-base border-2 border-gray-300 dark:border-gray-600 rounded-lg focus:border-primary focus:outline-none transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                            maxlength="20"
                        >
                        <div class="absolute left-3 top-3">
                            <i class="fas fa-mobile-alt text-gray-400"></i>
                        </div>
                    </div>
                    <button 
                        onclick="performSearch()" 
                        class="w-full mt-6 bg-primary hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors duration-300 text-base"
                    >
                        <i class="fas fa-search mr-2"></i>
                        بدء البحث
                    </button>
                </div>
            </div>

            <!-- Identity Information -->
            <div id="identityInfo" class="hidden mb-8">
                <div class="bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 border border-green-200 dark:border-green-700 rounded-xl p-6">
                    <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4 text-center">
                        <i class="fas fa-user-check mr-2 text-green-600"></i>
                        معلومات الهوية العامة
                    </h2>
                    
                    <div id="identityContent" class="text-center">
                        <!-- Identity content will be populated here -->
                    </div>
                    
                    <div class="mt-6 p-4 bg-blue-50 dark:bg-blue-900/30 rounded-lg">
                        <p class="text-sm text-blue-700 dark:text-blue-300 text-center">
                            <i class="fas fa-info-circle mr-2"></i>
                            هذه المعلومات مأخوذة من السجلات العامة المتاحة ومصادر موثوقة
                        </p>
                    </div>
                </div>
            </div>

            <!-- Search Results -->
            <div id="searchResults" class="hidden">
                <h2 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-6 text-center">
                    <i class="fas fa-list mr-2"></i>
                    نتائج البحث
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="resultsContainer">
                    <!-- Results will be populated here -->
                </div>
            </div>

            <!-- Loading Animation -->
            <div id="loadingAnimation" class="hidden text-center py-12">
                <div class="inline-flex items-center">
                    <div class="relative">
                        <div class="w-12 h-12 rounded-full bg-primary"></div>
                        <div class="absolute top-0 left-0 w-12 h-12 rounded-full bg-primary pulse-ring"></div>
                    </div>
                    <span class="mr-4 text-gray-600 dark:text-gray-400 text-lg">جاري البحث...</span>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="bg-gray-100 dark:bg-gray-800 py-6 mt-12">
            <div class="container mx-auto px-4 text-center">
                <p class="text-gray-600 dark:text-gray-400">
                    <i class="fas fa-info-circle mr-2"></i>
                    يتم البحث في المصادر العامة المتاحة فقط
                </p>
            </div>
        </footer>
    </div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Search platforms configuration
        const searchPlatforms = [
            {
                name: 'Facebook',
                icon: 'fab fa-facebook',
                color: 'bg-blue-600',
                url: 'https://www.facebook.com/search/people/?q=',
                description: 'البحث في ملفات Facebook العامة'
            },
            {
                name: 'Google',
                icon: 'fab fa-google',
                color: 'bg-red-500',
                url: 'https://www.google.com/search?q=',
                description: 'البحث العام في Google'
            },
            {
                name: 'LinkedIn',
                icon: 'fab fa-linkedin',
                color: 'bg-blue-700',
                url: 'https://www.linkedin.com/search/results/people/?keywords=',
                description: 'البحث في ملفات LinkedIn العامة'
            },
            {
                name: 'Twitter/X',
                icon: 'fab fa-twitter',
                color: 'bg-sky-500',
                url: 'https://twitter.com/search?q=',
                description: 'البحث في تغريدات عامة'
            },
            {
                name: 'Instagram',
                icon: 'fab fa-instagram',
                color: 'bg-pink-600',
                url: 'https://www.instagram.com/explore/tags/',
                description: 'البحث في المحتوى العام'
            },
            {
                name: 'WhatsApp Info',
                icon: 'fab fa-whatsapp',
                color: 'bg-green-500',
                url: 'https://www.google.com/search?q="',
                description: 'البحث عن معلومات WhatsApp العامة',
                suffix: '" WhatsApp'
            }
        ];

        function validatePhoneNumber(phone) {
            // Remove spaces and special characters except +
            const cleanPhone = phone.replace(/[^\d+]/g, '');
            
            // Check if it's a valid phone number format
            if (cleanPhone.length < 8 || cleanPhone.length > 20) {
                return false;
            }
            
            // Check if it starts with + or a digit
            if (!cleanPhone.match(/^[\+]?[\d]{8,20}$/)) {
                return false;
            }
            
            return true;
        }

        function formatPhoneNumber(phone) {
            // Remove all non-digit characters except +
            return phone.replace(/[^\d+]/g, '');
        }

        function performSearch() {
            const phoneInput = document.getElementById('phoneNumber');
            const phoneNumber = phoneInput.value.trim();
            
            if (!phoneNumber) {
                showCustomAlert('يرجى إدخال رقم هاتف');
                phoneInput.focus();
                return;
            }
            
            if (!validatePhoneNumber(phoneNumber)) {
                showCustomAlert('يرجى إدخال رقم هاتف صحيح');
                phoneInput.focus();
                return;
            }
            
            const formattedPhone = formatPhoneNumber(phoneNumber);
            
            // Show loading animation and hide previous results
            document.getElementById('loadingAnimation').classList.remove('hidden');
            document.getElementById('searchResults').classList.add('hidden');
            document.getElementById('identityInfo').classList.add('hidden');
            
            // First, get identity information
            getIdentityInfo(formattedPhone);
        }

        // Register handlers for multiple search steps
        if (window.Poe) {
            // Handler for phone analysis
            window.Poe.registerHandler("phone-analysis-handler", (result, context) => {
                const msg = result.responses[0];
                
                if (msg.status === "complete") {
                    try {
                        const analysisData = JSON.parse(msg.content);
                        displayPhoneAnalysis(analysisData);
                        
                        // Start name search with better context
                        setTimeout(() => {
                            startNameSearch(context.phoneNumber, analysisData);
                        }, 500);
                    } catch (error) {
                        displayPhoneAnalysisFromText(msg.content);
                        setTimeout(() => {
                            startNameSearch(context.phoneNumber, null);
                        }, 500);
                    }
                }
            });

            // Handler for name search
            window.Poe.registerHandler("name-search-handler", (result, context) => {
                const msg = result.responses[0];
                
                if (msg.status === "error") {
                    updateNameSearchResult("حدث خطأ في البحث عن الاسم", "error");
                } else if (msg.status === "incomplete") {
                    updateNameSearchResult("جاري البحث في قواعد البيانات العامة...", "loading");
                } else if (msg.status === "complete") {
                    try {
                        const nameData = JSON.parse(msg.content);
                        updateNameSearchResult(nameData.name || "غير متوفر في المصادر العامة", "success", nameData);
                    } catch (error) {
                        updateNameSearchResult(msg.content || "غير متوفر في المصادر العامة", "success");
                    }
                    
                    // Show search results after name search
                    setTimeout(() => {
                        displaySearchResults(context.phoneNumber);
                        document.getElementById('loadingAnimation').classList.add('hidden');
                        document.getElementById('searchResults').classList.remove('hidden');
                        
                        document.getElementById('identityInfo').scrollIntoView({ 
                            behavior: 'smooth' 
                        });
                    }, 1000);
                }
            });
        }

        async function getIdentityInfo(phoneNumber) {
            document.getElementById('identityInfo').classList.remove('hidden');
            
            // Start with phone analysis
            startPhoneAnalysis(phoneNumber);
        }

        async function startPhoneAnalysis(phoneNumber) {
            const identityContent = document.getElementById('identityContent');
            identityContent.innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary ml-3"></div>
                        <span class="text-gray-600 dark:text-gray-400">جاري تحليل الرقم...</span>
                    </div>
                </div>
            `;
            
            try {
                if (window.Poe) {
                    // First, analyze the phone number structure
                    await window.Poe.sendUserMessage(
                        `@Claude-Sonnet-4 احلل رقم الهاتف التالي وأخبرني عن تفاصيله التقنية: ${phoneNumber}

                        أريد تحليل شامل للرقم يتضمن:
                        1. رمز البلد والمنطقة
                        2. شركة الاتصالات المحتملة
                        3. نوع الخط (محمول/أرضي)
                        4. تاريخ تخصيص هذا الرقم تقريباً
                        5. أي معلومات تقنية أخرى

                        قدم الإجابة في JSON بهذا الشكل:
                        {
                            "countryCode": "رمز البلد",
                            "country": "اسم البلد",
                            "region": "المنطقة أو المدينة",
                            "carrier": "شركة الاتصالات المحتملة",
                            "lineType": "نوع الخط",
                            "numberAge": "عمر تخصيص الرقم التقريبي",
                            "confidence": "عالي/متوسط/منخفض"
                        }`,
                        {
                            handler: "phone-analysis-handler",
                            stream: false,
                            openChat: false,
                            handlerContext: { phoneNumber: phoneNumber }
                        }
                    );
                } else {
                    // Fallback
                    setTimeout(() => {
                        displayBasicPhoneInfo(phoneNumber);
                    }, 1500);
                }
            } catch (error) {
                console.error('Error in phone analysis:', error);
                displayBasicPhoneInfo(phoneNumber);
            }
        }

        async function startNameSearch(phoneNumber, phoneAnalysis) {
            updateNameSearchResult("جاري البحث عن الاسم في المصادر العامة...", "loading");
            
            try {
                if (window.Poe) {
                    const searchContext = phoneAnalysis ? 
                        `الرقم ${phoneNumber} من ${phoneAnalysis.country || 'غير محدد'}, شركة ${phoneAnalysis.carrier || 'غير محددة'}` 
                        : phoneNumber;
                    
                    await window.Poe.sendUserMessage(
                        `@Claude-Sonnet-4 ابحث عن الاسم الحقيقي المرتبط بهذا الرقم: ${searchContext}

                        استخدم الطرق التالية للبحث:
                        1. البحث في السجلات العامة المتاحة
                        2. فحص المصادر الرسمية للأرقام
                        3. البحث في قواعد البيانات العامة للهواتف
                        4. مراجعة الإعلانات أو المنشورات العامة التي تحتوي على هذا الرقم

                        أريد معلومات دقيقة فقط. إذا لم تجد معلومات مؤكدة، قل "غير متوفر".

                        الإجابة في JSON:
                        {
                            "name": "الاسم الحقيقي إذا توفر",
                            "source": "مصدر المعلومة",
                            "confidence": "مستوى الثقة",
                            "additionalInfo": "معلومات إضافية",
                            "searchStatus": "نجح/فشل"
                        }`,
                        {
                            handler: "name-search-handler",
                            stream: true,
                            openChat: false,
                            handlerContext: { phoneNumber: phoneNumber }
                        }
                    );
                } else {
                    // Fallback
                    setTimeout(() => {
                        updateNameSearchResult("غير متوفر في الوضع التجريبي", "success");
                        setTimeout(() => {
                            displaySearchResults(phoneNumber);
                            document.getElementById('loadingAnimation').classList.add('hidden');
                            document.getElementById('searchResults').classList.remove('hidden');
                        }, 1000);
                    }, 2000);
                }
            } catch (error) {
                console.error('Error in name search:', error);
                updateNameSearchResult("فشل في البحث عن الاسم", "error");
            }
        }

        function displayPhoneAnalysis(data) {
            const identityContent = document.getElementById('identityContent');
            
            identityContent.innerHTML = `
                <div class="space-y-4">
                    <div class="text-center mb-4">
                        <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200">تحليل رقم الهاتف</h3>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-globe text-blue-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">البلد</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.country || 'غير محدد'}</p>
                            <p class="text-sm text-gray-500">${data.countryCode || ''}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-map-marker-alt text-green-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">المنطقة</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.region || 'غير محدد'}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-building text-purple-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">شركة الاتصالات</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.carrier || 'غير محدد'}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-phone text-orange-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">نوع الخط</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.lineType || 'غير محدد'}</p>
                        </div>
                    </div>
                    
                    <!-- Name search placeholder -->
                    <div id="nameSearchSection" class="bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-user text-indigo-600 text-lg ml-2"></i>
                            <span class="font-bold text-gray-700 dark:text-gray-300">الاسم الحقيقي</span>
                        </div>
                        <div id="nameResult" class="text-gray-600 dark:text-gray-400">
                            <i class="fas fa-search ml-1"></i>
                            جاري البحث...
                        </div>
                    </div>
                </div>
            `;
        }

        function displayPhoneAnalysisFromText(content) {
            const identityContent = document.getElementById('identityContent');
            identityContent.innerHTML = `
                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-200 mb-2">تحليل الرقم</h3>
                    <div class="text-gray-900 dark:text-white whitespace-pre-wrap">${content}</div>
                    
                    <div class="mt-4 bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-user text-indigo-600 text-lg ml-2"></i>
                            <span class="font-bold text-gray-700 dark:text-gray-300">الاسم الحقيقي</span>
                        </div>
                        <div id="nameResult" class="text-gray-600 dark:text-gray-400">
                            <i class="fas fa-search ml-1"></i>
                            جاري البحث...
                        </div>
                    </div>
                </div>
            `;
        }

        function displayBasicPhoneInfo(phoneNumber) {
            // Basic phone number analysis without AI
            const countryCode = phoneNumber.match(/^\+?(\d{1,4})/)?.[1] || '';
            let country = 'غير محدد';
            let region = 'غير محدد';
            
            // Basic country detection
            if (countryCode.startsWith('966')) {
                country = 'السعودية';
                region = 'المملكة العربية السعودية';
            } else if (countryCode.startsWith('971')) {
                country = 'الإمارات';
                region = 'دولة الإمارات العربية المتحدة';
            } else if (countryCode.startsWith('965')) {
                country = 'الكويت';
                region = 'دولة الكويت';
            } else if (countryCode.startsWith('974')) {
                country = 'قطر';
                region = 'دولة قطر';
            } else if (countryCode.startsWith('973')) {
                country = 'البحرين';
                region = 'مملكة البحرين';
            } else if (countryCode.startsWith('968')) {
                country = 'عمان';
                region = 'سلطنة عمان';
            } else if (countryCode.startsWith('962')) {
                country = 'الأردن';
                region = 'المملكة الأردنية الهاشمية';
            } else if (countryCode.startsWith('961')) {
                country = 'لبنان';
                region = 'الجمهورية اللبنانية';
            } else if (countryCode.startsWith('20')) {
                country = 'مصر';
                region = 'جمهورية مصر العربية';
            }
            
            const basicData = {
                country: country,
                countryCode: '+' + countryCode,
                region: region,
                carrier: 'يتطلب تحليل متقدم',
                lineType: 'محمول',
                confidence: 'متوسط'
            };
            
            displayPhoneAnalysis(basicData);
            
            // Start name search
            setTimeout(() => {
                startNameSearch(phoneNumber, basicData);
            }, 500);
        }

        function updateNameSearchResult(result, status, data = null) {
            const nameResult = document.getElementById('nameResult');
            if (!nameResult) return;
            
            if (status === "loading") {
                nameResult.innerHTML = `
                    <div class="flex items-center">
                        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-indigo-600 ml-2"></div>
                        <span>${result}</span>
                    </div>
                `;
            } else if (status === "error") {
                nameResult.innerHTML = `
                    <div class="text-red-600 dark:text-red-400">
                        <i class="fas fa-exclamation-triangle ml-1"></i>
                        ${result}
                    </div>
                `;
            } else if (status === "success") {
                if (data && data.name && data.name !== 'غير متوفر') {
                    nameResult.innerHTML = `
                        <div class="text-green-600 dark:text-green-400">
                            <p class="text-lg font-bold">${data.name}</p>
                            ${data.source ? `<p class="text-sm">المصدر: ${data.source}</p>` : ''}
                            ${data.confidence ? `<p class="text-sm">مستوى الثقة: ${data.confidence}</p>` : ''}
                        </div>
                    `;
                } else {
                    nameResult.innerHTML = `
                        <div class="text-yellow-600 dark:text-yellow-400">
                            <i class="fas fa-info-circle ml-1"></i>
                            ${result}
                        </div>
                    `;
                }
            }
        }

        function displayIdentityInfo(data) {
            const identityContent = document.getElementById('identityContent');
            
            const confidenceColor = {
                'عالي': 'text-green-600 dark:text-green-400',
                'متوسط': 'text-yellow-600 dark:text-yellow-400',
                'منخفض': 'text-red-600 dark:text-red-400'
            };
            
            identityContent.innerHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-user text-blue-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">الاسم الحقيقي</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.name || 'غير متوفر'}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-map-marker-alt text-green-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">المنطقة</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.region || 'غير متوفر'}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-building text-purple-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">شركة الاتصالات</span>
                            </div>
                            <p class="text-lg font-bold text-gray-900 dark:text-white">${data.carrier || 'غير متوفر'}</p>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-shield-check text-orange-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">مستوى الثقة</span>
                            </div>
                            <p class="text-lg font-bold ${confidenceColor[data.confidence] || 'text-gray-500'}">${data.confidence || 'غير محدد'}</p>
                        </div>
                    </div>
                    
                    ${data.additionalInfo && data.additionalInfo !== 'غير متوفر' ? `
                        <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-info-circle text-indigo-600 text-lg ml-2"></i>
                                <span class="font-bold text-gray-700 dark:text-gray-300">معلومات إضافية</span>
                            </div>
                            <p class="text-gray-900 dark:text-white">${data.additionalInfo}</p>
                        </div>
                    ` : ''}
                    
                    ${data.source ? `
                        <div class="text-center">
                            <p class="text-xs text-gray-500 dark:text-gray-400">
                                <i class="fas fa-database ml-1"></i>
                                المصدر: ${data.source}
                            </p>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function displayIdentityInfoFromText(content) {
            const identityContent = document.getElementById('identityContent');
            
            identityContent.innerHTML = `
                <div class="bg-white dark:bg-gray-700 p-4 rounded-lg">
                    <div class="flex items-center mb-2">
                        <i class="fas fa-search text-blue-600 text-lg ml-2"></i>
                        <span class="font-bold text-gray-700 dark:text-gray-300">نتائج البحث</span>
                    </div>
                    <div class="text-gray-900 dark:text-white whitespace-pre-wrap">${content}</div>
                </div>
            `;
        }

        function displayMockIdentityInfo(phoneNumber) {
            // Mock data for demonstration when Poe API is not available
            const mockData = {
                name: "يتطلب اتصال بالإنترنت للبحث الحقيقي",
                region: "تحديد تلقائي للمنطقة",
                carrier: "يتم تحديدها من خلال تحليل الرقم",
                additionalInfo: "هذا مثال توضيحي - في الاستخدام الفعلي ستظهر المعلومات الحقيقية",
                confidence: "متوسط",
                source: "النظام التجريبي"
            };
            
            displayIdentityInfo(mockData);
        }

        function displaySearchResults(phoneNumber) {
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            // Get the identified name if available
            const identityContent = document.getElementById('identityContent');
            let identifiedName = '';
            try {
                const nameElement = identityContent.querySelector('[data-name]');
                if (nameElement) {
                    identifiedName = nameElement.getAttribute('data-name');
                }
            } catch (error) {
                // Fallback to extract name from identity display
                const nameDisplay = identityContent.querySelector('.text-lg.font-bold');
                if (nameDisplay && nameDisplay.textContent !== 'غير متوفر') {
                    identifiedName = nameDisplay.textContent;
                }
            }
            
            searchPlatforms.forEach((platform, index) => {
                let searchQuery, searchUrl;
                
                // Create search query based on platform and available information
                if (identifiedName && identifiedName !== 'غير متوفر' && identifiedName.trim() !== '') {
                    // Use identified name for more accurate search
                    searchQuery = encodeURIComponent(`${identifiedName} ${phoneNumber}`);
                } else {
                    // Fallback to phone number only
                    searchQuery = encodeURIComponent(phoneNumber);
                }
                
                searchUrl = platform.url + searchQuery + (platform.suffix || '');
                
                const resultCard = document.createElement('div');
                resultCard.className = 'search-card bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 result-item';
                resultCard.style.animationDelay = `${index * 0.1}s`;
                
                // Enhanced description based on identified name
                let enhancedDescription = platform.description;
                if (identifiedName && identifiedName !== 'غير متوفر' && identifiedName.trim() !== '') {
                    enhancedDescription = `البحث عن "${identifiedName}" في ${platform.name}`;
                }
                
                resultCard.innerHTML = `
                    <div class="flex items-center mb-4">
                        <div class="${platform.color} text-white rounded-full w-12 h-12 flex items-center justify-center text-xl">
                            <i class="${platform.icon}"></i>
                        </div>
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-200 mr-3">${platform.name}</h3>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400 mb-2 text-sm">${enhancedDescription}</p>
                    ${identifiedName && identifiedName !== 'غير متوفر' && identifiedName.trim() !== '' ? 
                        `<p class="text-primary font-semibold text-sm mb-4">
                            <i class="fas fa-user-tag mr-1"></i>
                            باستخدام الاسم: ${identifiedName}
                        </p>` : ''
                    }
                    <a href="${searchUrl}" 
                       target="_blank" 
                       rel="noopener noreferrer"
                       class="inline-flex items-center bg-primary hover:bg-purple-700 text-white font-bold py-2 px-4 rounded transition-colors duration-300">
                        <i class="fas fa-external-link-alt mr-2"></i>
                        فتح البحث
                    </a>
                `;
                
                resultsContainer.appendChild(resultCard);
            });
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg max-w-sm w-full mx-4 text-center">
                    <div class="mb-4">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-3xl"></i>
                    </div>
                    <p class="text-gray-700 dark:text-gray-300 mb-4">${message}</p>
                    <button class="px-6 py-2 bg-primary text-white hover:bg-purple-700 rounded transition-colors" onclick="this.closest('.fixed').remove()">
                        موافق
                    </button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Allow Enter key to trigger search
        document.getElementById('phoneNumber').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Auto-format phone number input
        document.getElementById('phoneNumber').addEventListener('input', function(e) {
            let value = e.target.value;
            
            // Remove any non-digit characters except +
            value = value.replace(/[^\d+]/g, '');
            
            // Ensure + is only at the beginning
            if (value.includes('+')) {
                const parts = value.split('+');
                value = '+' + parts.join('');
            }
            
            e.target.value = value;
        });
    </script>
</body>
</html>
